<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Academic Transcript</title>
    <script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;600;700&display=swap');
        
        body {
    font-family: 'Hind Siliguri', sans-serif;
    background-color: #525252;
    margin: 0;
    padding: 20px 0;
    
    display: flex;
    flex-direction: column;
    align-items: center;
    
    min-height: 100vh;
    min-width: fit-content; 
}


       #transcript-paper {
    width: 210mm;
    min-width: 210mm;
    height: 297mm;
    min-height: 297mm; 
    background: white;
    padding: 15mm;
    position: relative;
    box-shadow: 0 0 20px rgba(0,0,0,0.5);
    overflow: hidden;
    
    background-image: url('texture.png');
    background-size: 100% 100%;
    background-repeat: no-repeat;
    background-position: center;
    transform-origin: top center; 
    transition: transform 0.2s ease;
}

        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 90px;
            color: rgba(30, 58, 138, 0.05);
            font-weight: 800;
            pointer-events: none;
            z-index: 0;
            white-space: nowrap;
        }

        @media print {
            .no-print { display: none !important; }
            body { background: none; margin: 0; }
            #transcript-paper { box-shadow: none; margin: 0; }
        }
    </style>
</head>
<body class="py-8">

    <div class="no-print mb-6 text-center space-x-4">
        <button onclick="downloadPDF()" class="bg-blue-600 text-white px-6 py-2 rounded-full shadow hover:bg-blue-700 font-bold flex items-center gap-2 inline-flex">
            <span>üìÑ</span> PDF ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
        </button>
        <a href="index.html" class="bg-gray-600 text-white px-6 py-2 rounded-full shadow hover:bg-gray-700 font-bold inline-flex items-center gap-2">
            <span>üè†</span> ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú
        </a>
    </div>

    <div id="transcript-paper">
        <div class="watermark">OFFICIAL COPY</div>

        <div class="relative z-10 flex flex-col items-center text-center border-b-2 border-blue-900 pb-2 mb-4">
            <img src="logo.png" alt="Logo" class="w-20 h-20 mb-1">
            <h1 id="schoolName" class="text-3xl font-bold text-blue-900 uppercase tracking-wide">‡¶∏‡ßç‡¶ï‡ßÅ‡¶≤‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h1>
            <p id="schoolLoc" class="text-sm text-gray-600 mb-1">‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ</p>
            <div class="bg-blue-900 text-white px-6 py-1 rounded-full text-sm font-bold uppercase tracking-widest mb-1">
                Academic Transcript
            </div>
            <p id="examType" class="font-semibold text-gray-800 italic text-sm">---</p>
        </div>

        <div class="grid grid-cols-2 gap-6 mb-4 text-sm relative z-10 bg-white/60 p-4 border border-blue-100 rounded-lg backdrop-blur-sm">
            <div class="space-y-1.5">
                <p><strong>‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶æ‡¶∞‡ßç‡¶•‡ßÄ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> <span id="sName" class="text-blue-900 font-bold text-base uppercase">---</span></p>
                <p><strong>‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> <span id="fName">---</span></p>
                <p><strong>‡¶Æ‡¶æ‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ:</strong> <span id="mName">---</span></p>
                <p><strong>‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü ‡¶Ü‡¶á‡¶°‡¶ø:</strong> <span id="sId" class="font-mono font-bold bg-gray-100 px-1 rounded">---</span></p>
            </div>
            <div class="space-y-1.5 text-right">
                <p><strong>‡¶∂‡ßç‡¶∞‡ßá‡¶£‡ßÄ:</strong> <span id="sClass">---</span></p>
                <p><strong>‡¶¨‡¶ø‡¶≠‡¶æ‡¶ó:</strong> <span id="sGroup">---</span></p>
                <p><strong>‡¶ú‡¶®‡ßç‡¶Æ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ:</strong> <span id="sDob">---</span></p>
                <p><strong>‡¶´‡¶≤‡¶æ‡¶´‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡¶æ‡¶∂:</strong> <span id="pDate">28/12/2026</span></p>
            </div>
        </div>

        <table class="w-full border-collapse border border-gray-400 mb-4 relative z-10 text-sm">
            <thead class="bg-blue-50">
                <tr>
                    <th class="border border-gray-400 p-1.5 text-center w-12">Code</th>
                    <th class="border border-gray-400 p-1.5 text-left pl-4">Subject Name</th>
                    <th class="border border-gray-400 p-1.5 text-center w-20">Ltr. Grade</th>
                    <th class="border border-gray-400 p-1.5 text-center w-20">Grade Pt.</th>
                </tr>
            </thead>
            <tbody id="marksTable" class="text-center bg-white/40">
                </tbody>
            <tfoot class="bg-blue-100 font-bold border-t-2 border-blue-900">
                <tr>
                    <td colspan="3" class="border border-gray-400 p-2 text-right text-gray-700">Total GPA:</td>
                    <td id="totalGpa" class="border border-gray-400 p-2 text-blue-900 text-lg">---</td>
                </tr>
                <tr>
                    <td colspan="3" class="border border-gray-400 p-2 text-right text-gray-700">Final Grade:</td>
                    <td id="finalGrade" class="border border-gray-400 p-2 text-lg">---</td>
                </tr>
            </tfoot>
        </table>

        <div class="absolute bottom-16 left-0 w-full px-12 z-10">
            <div class="flex justify-between items-end">
                
                <div class="w-40">
                    <p class="text-[10px] font-bold mb-1 border-b border-black inline-block">GRADING SCALE</p>
                    <table class="w-full text-[9px] border-collapse border border-gray-300 bg-white">
                        <tr class="bg-gray-100">
                            <td class="border px-1">Marks</td><td class="border px-1">GP</td><td class="border px-1">LG</td>
                        </tr>
                        <tr><td>80-100</td><td>5.00</td><td>A+</td></tr>
                        <tr><td>70-79</td><td>4.00</td><td>A</td></tr>
                        <tr><td>60-69</td><td>3.50</td><td>A-</td></tr>
                        <tr><td>50-59</td><td>3.00</td><td>B</td></tr>
                        <tr><td>40-49</td><td>2.00</td><td>C</td></tr>
                        <tr><td>33-39</td><td>1.00</td><td>D</td></tr>
                        <tr><td>0-32</td><td>0.00</td><td>F</td></tr>
                    </table>
                </div>

                <div class="flex gap-40 text-center">
                    <div>
                        <div class="h-10"></div> <div class="w-32 border-t border-black text-xs font-bold pt-1">Seal and Date of Registry</div>
                    </div>
                    <div>
                        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Jon_Kirsch%27s_Signature.png" class="w-24 h-8 mx-auto mb-1 opacity-80 block">
                        <div class="w-32 border-t border-black text-xs font-bold pt-1">Principal</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="absolute bottom-4 left-0 w-full text-center">
            <p class="text-[9px] text-gray-500 uppercase tracking-widest">
                System Generated Document | Developed by Result Portal System
            </p>
        </div>
    </div>

    <script>
        const jsonUrl = "https://gist.githubusercontent.com/RahmatRumon/9ad0377ed9608b1f64a343870ce037de/raw/result.json";

        window.onload = async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const dob = decodeURIComponent(urlParams.get('dob'));

            if (!id || !dob) {
                alert("‡¶∏‡¶†‡¶ø‡¶ï ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø! ‡¶π‡ßã‡¶Æ ‡¶™‡ßá‡¶ú‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§");
                window.location.href = 'index.html';
                return;
            }

            try {
                const response = await fetch(jsonUrl);
                const data = await response.json();
                
                const student = data.studentResults.find(s => s["ID No."] == id && s["DOB"] == dob);

                if (student) {
                    renderTranscript(data.schoolInfo, student);
                } else {
                    alert("‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø!");
                    window.location.href = 'index.html';
                }
            } catch (err) {
                console.error(err);
                alert("‡¶°‡¶æ‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            }
        };

        function renderTranscript(school, student) {
              document.getElementById('schoolName').innerText = school.School_Name;
            document.getElementById('schoolLoc').innerText = school.Location;
            document.getElementById('examType').innerText = school.Exam_Type;
         document.getElementById('sName').innerText = student.Name;
            document.getElementById('fName').innerText = student.FName;
            document.getElementById('mName').innerText = student.MName;
            document.getElementById('sId').innerText = student["ID No."];
            document.getElementById('sClass').innerText = school.Class;
            document.getElementById('sGroup').innerText = school.Group;
            document.getElementById('sDob').innerText = student.DOB;

            const marksTable = document.getElementById('marksTable');
            marksTable.innerHTML = "";
            
            for(let i=1; i<=8; i++) {
                if(student["S"+i]) { 
                    const row = `
                        <tr>
                            <td class="border border-gray-400 p-1.5 text-gray-500 text-xs">10${i}</td>
                            <td class="border border-gray-400 p-1.5 text-left pl-4 font-semibold text-gray-800">${student["S"+i]}</td>
                            <td class="border border-gray-400 p-1.5 font-bold">${student["N"+i]}</td> <td class="border border-gray-400 p-1.5 font-bold">${parseFloat(student["GP"+i]).toFixed(2)}</td>
                        </tr>
                    `;
                    marksTable.innerHTML += row;
                }
            }
          document.getElementById('totalGpa').innerText = student["Grade Point"];
            document.getElementById('finalGrade').innerText = student["GPA (Letter)"];
        }

        function downloadPDF() {
    const element = document.getElementById('transcript-paper');
    const sId = document.getElementById('sId').innerText;

    const opt = {
        margin: [5, 5],
        filename: `Result_${sId}.pdf`,
        image: { type: 'jpeg', quality: 0.95 },
        html2canvas: { 
            scale: 2, 
            useCORS: true,
            letterRendering: true 
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };
            
    const btn = event.currentTarget;
    const originalText = btn.innerHTML;
    btn.innerText = "‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
    
    html2pdf().set(opt).from(element).save().then(() => {
        btn.innerHTML = originalText;
    }).catch(err => {
        alert("‡¶™‡¶ø‡¶°‡¶ø‡¶è‡¶´ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶∏‡¶ø‡¶°‡¶ø‡¶è‡¶® ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        btn.innerHTML = originalText;
    });
}
    </script>
</body>
</html>
